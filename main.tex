\documentclass{article}
\usepackage[T2A]{fontenc}
\usepackage[utf8x]{inputenc}
\usepackage[russian,english]{babel}
\usepackage{listings}

\begin{document}

\input{title}

\tableofcontents

\newpage

\section{Введение}

Характеристики энергопотребления микропроцессоров семейства «Эльбрус»
являются одним из важнейших факторов при создании вычислительных комплексов (ВК)
на их основе.

Основную часть управления электропитанием процессоров в операционной системе Linux берет на себя cpufreq, который изменяет частоту и уровень производительности процессора в зависимости от нагрузки процессора.

Еще одной важной деталью энергосбережения является мощность процессора в режиме холостого хода.

\subsection{Цель работы}
Снижение энергопотребления ВК на базе микропроцессоров Эльбрус-4С и Эльбрус-8С во время простоя (idle)
\subsection{Задачи}
Реализовать в драйвере cpuidle-e2k функциональность перевода вычислительного ядра в состояние глубокого сна
\subsection{Требования}
Управление подсистемой посредством команд

\newpage
\section{Схема взаимодействия}

\subsection{ACPI}
Усовершенствованный интерфейс управления конфигурацией и питанием

Открытый промышленный стандарт, впервые выпущенный в декабре 1996 года и разработанный совместно компаниями HP, Intel, Microsoft, Phoenix и Toshiba, который определяет общий интерфейс для обнаружения аппаратного обеспечения, управления питанием и конфигурации материнской платы и устройств.

\subsection{Состояния центрального процессора}

Стандарт ACPI включает в себя состояния C0, C1, C2, ... , Cn. Где С0 активное состояние при котором центральный процессор выполняет инструкции. Состояния с С1 по Cn это состояния сна потребляющие меньше энергии и рассеивающие меньше тепла. В состоянии сна процессор не выполняет никаких инструкций. Каждое состояние сна имеет задержку, связанную с входом и выходом из этого состояния, что способствует экономии электроэнергии. В целом, чем дольше задержка ввода/вывода, тем больше экономия электроэнергии в этом состоянии. Для экономии электроэнергии, Операционная система размещает ЦП в одно из поддерживаемых состояний во время простоя.

В микропроцессорах семейства Эльбрус есть поддержка подсистемы ядра Linux cpuidle.


\subsection{Cpuidle}
Ядро cpuidle поддерживает отдельно связанные списки всех зарегистрированных драйверов и зарегистрированных говерноров, и обнаруженых устройств(CPU).

Ядро cpuidle имеет обработчик, который подключается к указателю архитектурнонезависимой функции, который будет использоваться каждым отдельным процессором в неактивном состоянии. Перед тем как войти в состояние сна governour выбирает оптимальное состояние. А затем cpuidle вызывает точку входа для этого конкретного состояния в драйвере cpuidle. При возвращении из этого состояния существует необязательный обратный вызов говернора для сбора информации о действии в режиме сна.

Число и тип состояний сна могут меняться динамически в зависимости от конкретного состояния данной системы, например от батареи или переменного напряжения. Такое уведомление об изменении состояния системы переходит к драйверу idle, который будет вызывать 
\texttt{cpuidle\_force\_redetect()} в ядре cpuidle. Это приводит к временному удалению обработчика idle, а также к повторному обнаружению драйвером idle состояния, после чего повторно инициализируется состояние говернора, чтобы принять к сведению это изменение.

Подсистема ядра Linux, 

\subsection{State}
Это структура содержит сведения о каждом отдельном состоянии: потреблении электроэнергии, задержке выхода, статистике использования состояния и т.д.
\lstinputlisting{state.c}

\subsection{Governour}
\lstinputlisting{governour.c}

\subsection{Driver}
\lstinputlisting{driver.c}

\subsection{Device}
Структура содержит информацию о количестве состояний бездействия, которые поддерживаются каждым процессором, информацию о каждом из этих состояний (в массиве ) а также о состоянии этого устройства(CPU).
\lstinputlisting{device.c}




\newpage
\section{Детали реализаци}

\subsection{Алгоритм отключения ядра}

Фрагмент кода, приводящий к выключению синхронизации вычислительного ядра,
должен соответствовать нижеперечисленным правилам, иначе возможна подмена данных
или "зависание" ядра или даже всей машины.

1) Код выключения ядра должен быть резидентным как в физической, так и в
виртуальной памяти.

2) Код выключения ядра должен быть немодифицируемым.

3) Код выключения ядра исполняется на том же ядре.

4) Код выключения ядра не должен содержать операций обращения в память, за
исключением приведенных ниже спецопераций.

5) Код выключения ядра не должен содержать операций подготовки перехода и
предподкачки кода.

6) Код выключения ядра должен содержать инвалидацию регистров подготовки
перехода. Это позволяет избежать слабоконтролируемых спекулятивных обращений в
память от незавершенных операций подготовки перехода.

7) Код выключения ядра должен содержать операции гашения кэшей процессора:

	- операция очистки всего кэша данных (см. C.20.2);
	       - операция очистки всего кэша команд (см. C.20.4);
	      - операция очистки всего TLB (см. C.20.7);
Это позволяет избавиться от данных и трансляций, которые могут устареть пока
ядро выключено и не может реагировать на внешние события (например,
снупирование).

8) Перед исполнением операции выключения ядра весь фрагмент кода, приводящий к
выключению, должен быть подкачен в буфер команд. Это позволяет избежать
слабоконтролируемых спекулятивных обращений в память от незавершенной
предподкачки прямой ветви кода. Это требование предполагает двойной проход по
части кода, причем первый раз исполнительные операции пропускаются, а
исполняются только во время второго прохода.

9) Перед исполнением операции выключения ядра нужно дождаться завершения
активности подсистемы памяти. Для этого служит команда {}.

\newpage
\lstinputlisting{e2k_clk_off.c}

\subsection{Проблемы}

\newpage
\section{Заключение}

\section{Результаты}

\newpage
\section{Список литературы}


\end{document}




